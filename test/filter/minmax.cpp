#include <gtest/gtest.h>

#include <imp/common/matrix>
#include <imp/filter/minmax>


using namespace imp;


TEST(min_filter, radius_1)
{
    Matrix<int> test({
        { 1, 2, 3, 4, 5, 6, 7 },
        { 1, 2, 3, 4, 5, 6, 7 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 0, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 1, 2, 2, 1, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 7, 6, 5, 4, 3, 2, 1 },
    });


    Matrix<int> expected({
        { 1, 1, 2, 3, 4, 5, 6 },
        { 1, 1, 2, 2, 2, 2, 2 },
        { 1, 1, 0, 0, 0, 2, 2 },
        { 2, 2, 0, 0, 0, 2, 2 },
        { 2, 2, 0, 0, 0, 2, 2 },
        { 1, 1, 1, 1, 1, 2, 2 },
        { 1, 1, 1, 1, 1, 2, 2 },
        { 1, 1, 1, 1, 1, 1, 1 },
        { 2, 2, 2, 2, 2, 1, 1 },
    });

    ASSERT_TRUE( MinFilter(1).apply(test) == expected );
}


TEST(min_filter, radius_2)
{
    Matrix<int> test({
        { 1, 2, 3, 4, 5, 6, 7 },
        { 1, 2, 3, 4, 5, 6, 7 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 0, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 1, 2, 2, 1, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 7, 6, 5, 4, 3, 2, 1 },
    });


    Matrix<int> expected({
        { 1, 1, 1, 2, 2, 2, 2 },
        { 1, 0, 0, 0, 0, 0, 2 },
        { 1, 0, 0, 0, 0, 0, 2 },
        { 1, 0, 0, 0, 0, 0, 2 },
        { 1, 0, 0, 0, 0, 0, 2 },
        { 1, 0, 0, 0, 0, 0, 2 },
        { 1, 1, 1, 1, 1, 1, 1 },
        { 1, 1, 1, 1, 1, 1, 1 },
        { 1, 1, 1, 1, 1, 1, 1 },
    });

    ASSERT_TRUE( MinFilter(2).apply(test) == expected );
}


TEST(min_filter, radius_10)
{
    Matrix<int> test({
        { 1, 2, 3, 4, 5, 6, 7 },
        { 1, 2, 3, 4, 5, 6, 7 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 0, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 1, 2, 2, 1, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 7, 6, 5, 4, 3, 2, 1 },
    });


    Matrix<int> expected({
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
        { 0, 0, 0, 0, 0, 0, 0 },
    });

    ASSERT_TRUE( MinFilter(10).apply(test) == expected );
}



TEST(max_filter, radius_1)
{
    Matrix<int> test({
        { 1, 2, 3, 4, 5, 6, 7 },
        { 1, 2, 3, 4, 5, 6, 7 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 4, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 1, 2, 2, 1, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 7, 6, 5, 4, 3, 2, 1 },
    });


    Matrix<int> expected({
        { 2, 3, 4, 5, 6, 7, 7 },
        { 2, 3, 4, 5, 6, 7, 7 },
        { 2, 3, 4, 5, 6, 7, 7 },
        { 2, 2, 4, 4, 4, 2, 2 },
        { 2, 2, 4, 4, 4, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 7, 7, 6, 5, 4, 3, 2 },
        { 7, 7, 6, 5, 4, 3, 2 },
    });

    ASSERT_TRUE( MaxFilter(1).apply(test) == expected );
}


TEST(max_filter, radius_2)
{
    Matrix<int> test({
        { 1, 2, 3, 4, 5, 6, 7 },
        { 1, 2, 3, 4, 5, 6, 7 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 4, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 1, 2, 2, 1, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 7, 6, 5, 4, 3, 2, 1 },
    });


    Matrix<int> expected({
        { 3, 4, 5, 6, 7, 7, 7 },
        { 3, 4, 5, 6, 7, 7, 7 },
        { 3, 4, 5, 6, 7, 7, 7 },
        { 3, 4, 5, 6, 7, 7, 7 },
        { 2, 4, 4, 4, 4, 4, 2 },
        { 2, 4, 4, 4, 4, 4, 2 },
        { 7, 7, 7, 6, 5, 4, 3 },
        { 7, 7, 7, 6, 5, 4, 3 },
        { 7, 7, 7, 6, 5, 4, 3 },
    });

    ASSERT_TRUE( MaxFilter(2).apply(test) == expected );
}


TEST(max_filter, radius_10)
{
    Matrix<int> test({
        { 1, 2, 3, 4, 5, 6, 7 },
        { 1, 2, 3, 4, 5, 6, 7 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 0, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 1, 2, 2, 1, 2, 2, 2 },
        { 2, 2, 2, 2, 2, 2, 2 },
        { 7, 6, 5, 4, 3, 2, 1 },
    });


    Matrix<int> expected({
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
        { 7, 7, 7, 7, 7, 7, 7 },
    });

    ASSERT_TRUE( MaxFilter(10).apply(test) == expected );
}